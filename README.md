# terraform-aws-threetierapp
#### Terraform code that creates a VPC with all the networking and then deploys a 3 tier application onto the stack. The web tier has multiple EC2 instances (across AZs) with NGINX servers installed on them that run a sample Angular app. The instances are front-ended by an external ALB. An alias DNS record is created in an existing DNS hosted zone that points at the public ALB. The app tier has multiple EC2 instances (across AZs) with a sample Spring boot (REST API) application installed on them. The instances are front-ended by an internal ALB. A private DNS hosted zone (accessible only from the VPC) is created with the same name as the public DNS hosted zone (split DNS) and an alias DNS record is created in it that points at the private ALB. The web servers call the REST API on the private ALB and display the results on the front-end. The database tier is a work in progress at this point. Once built, it will be used by the app tier to fetch records.  

The code has the following modules - 
* **Networking** - For VPC and all the related networking. We are using the 10.16.0.0/16 CIDR for the VPC and 16 /20 subnets (4 each for web, app, db and reserved). The subnets are spread across 4 AZs for high availability. This also creates Gateway endpoint (for S3) and multiple Interface endpoints in the App subnets for Sessions Manager.
* **Compute** - For the launch template, EC2 instance, instance profile and security groups. The compute module first builds a launch template complete with user data and other settings and uses that to launch an instance. The Angular and Spring boot code resides in an S3 bucket that is pulled by the EC2 instances during bootstrapping.
* **Load Balancing** -  For setting up the ASG, ALB, target group, target group attachments and listener for both web and app tiers. 
* **Root** - This is the root module for orchestration between the other modules. The dynamic values are passed in from here to the modules. This makes the modules re-usable. 
* **DNS** - This is for creating an alias record to the ALB DNS, in an existing public hosted zone. This also creates a private DNS hosted zone (accessible only from the VPC) with the same name as the public DNS hosted zone (split DNS) and an alias DNS record is created in it that points at the private ALB.
